# 操作系统知识

## OS概述
### OS 两大作用
（1）通过资源管理提高计算机系统的效率。 
（2）改善人机界面，向用户提供良好的工作环境。 
### OS 特征
并发性、共享性、虚拟性、不确定性。 
### OS 功能
进程管理、文件管理、存储管理、设备管理、作业管理。 
### OS 分类
批处理、分时、实时、网络（集中、C/S、对等）、分布式、微型、嵌入式。

## 进程管理
### 进程间通信
  - 管道：最简单的IPC形式，本质是内核中的一个缓冲区。非为匿名管道和命名管道。特点是单向，半双工，面向字节流。
  - 消息队列：内核中的消息链表，允许进程异步发送和接收格式化数据。特点是异步，消息有类型。
  - 共享内存：允许多个进程访问同一块内存区块。进程将一块物理内存映射到自己虚拟地址空间中，操作内存不需要经过内核。特点：最快的IPC方式，进程需要自己负责对共享内存的访问。
  - 信号量（PV操作）： 用于进程之间的同步和互斥，是一个整数值计数器。P（等待）和V（发送信号）操作。
  - 套接字：普遍用于网络通信，在一台机器上，也可以进程通信。
  - 信号：是进程间发送的软件中断，用于通知接受进程发生的某个事件。用于异步通知和异常处理。
### 进程的状态
三态模型：就绪状态、运行状态、阻塞状态
五态模型：创建状态、就绪状态、运行状态、阻塞状态、终止状态
七态模型：创建状态、就绪状态、运行状态、挂起状态、交换状态、阻塞状态、终止状态
### 进程调度

三级调度
1. 低级调度
  - 进程调度（处于就绪状态的进程）、短周期调度器
  - 从就绪队列中选择进程，分配cpu运行
2. 中级调度
  - 内存调度（处于挂起状态的进程）、交换调度器
  - 将外存中的进程调度回内存，或者把内存中的进程调度出外存
3. 高级调度
  - 作业调度、长期调度器
  - 将外存中的哪些作业（进程）调度进内存，即并行的作业。
调度算法：目标是平衡cpu利用率、吞吐量、周转时间、响应时间、公平性
1. 先来先服务
2. 短作业优先
3. 优先级调度
4. 时间片轮询
5. 多级反馈队列
6. 最短剩余时间优先

进程优先级确认
1. 静态优先级
2. 动态优先级

### 死锁

必要条件
1. 互斥条件
2. 持有并等待条件
3. 不可抢占条件
4. 循环等待条件

死锁处理
1. 死锁预防
  - 通过破坏死锁的4个必要条件预防死锁
2. 死锁避免
  - 在系统运行时，动态检查资源分配情况，确保系统不会进入不安全状态（银行家算法）
3. 死锁检测与恢复
   - 允许系统进入死锁状态，定期运行监测算法识别死锁并采取措施进行恢复
4. 死锁忽略
  - 假定死锁永远不会发生，不对死锁采取任何措施

### 存储管理

#### 存储结构
1. 寄存器－Cache－主存－外存。 
2. 虚拟地址：是操作系统为每个进程分配的用于访问主存的地址，是进程看到的地址空间，与实际不同，操作系统通过地址映射机制（页表），将虚拟地址映射为物理地址，实现内存保护，隔离和灵活管理。 
3. 地址空间：是进程或系统可用的所有地址合集，对于进程，操作系统会分配一个独立的虚拟地址空间，包含进程可访问的所有地址范围。
4. 存储空间：是指实际的物理内存中可用的存储单元的合集。
#### 存储管理方案
  - 固定分区：将内存划分为若干个大小固定的分区，每个分区只能装载一个进程。分区在启动时确认，不能动态改变，会造成内存碎片。
  - 可变分区：内存分区大小不固定，根据实际需要动态分配分区。有新进程时，操作系统在空闲区中找到合适的空间分配。可能产生外部碎片
  - 分区分配算法：首次适应（从头检查，找到第一个足够大的分区分配）、最佳适应（查找所有分区，选择最小但能满足需求的分区）、最差适应（查找所有，选择最大的分区分配）、循环首次适应（类似首次适应，但每次分配从上次结束的位置继续查找，提高分配效率）。 
#### 分页存储
1. 存分页存储管理：
  - 分页是把进程的虚拟地址空间和物理捏村都划分为大小相同的页和页框，进程运行时，操作系统只把需要的页装入物理内存，不必一次性分配连续的空间，解决内存碎片问题。 
  - 地址结构：虚拟地址由两部分组成，页号和页内偏移量。页号用于查找页表，确定虚拟页对应的物理页框；页内偏移量去顶该页内的具体位置。
  - 地址映射原理：操作系统为每个进程维护一个页表，记录虚拟页号和物理页框的对应关系。当进程访问某个虚拟地址时，取出虚拟地址页号，在页表中查找对应的物理页框号，用物理页框号和页内偏移量拼接，得到物理地址。当页表项不存在时，发生缺页中断，操作系统将所需页从外存调入内存。
2. 快表：提高地址转换效率，是一种高速缓存，用于存放最近使用的页表项（虚拟页号与物理页框的映射），当进程访问内存时，先查快表，命中直接得到物理地址
3. 两级页表机制：解决页表过大，难以管理的问题，适用于大地址空间。将页表分为两级，一级存二级页表的地址，二级存实际的页框号。虚拟地址分为一级页号，二级页号和页内偏移。
#### 分段存储
1. 分段原理：将进程的地址空间分为若干个段，每个段是一个逻辑模块，如代码段，数据段，堆栈段。每段大小不固定，按实际需要分配。
2. 地址结构：虚拟地址分为段号和段内偏移量。
3. 地址映射原理：操作系统为每个进程维护一个段表，记录每个段的起始地址和段长度。
4. 容易产生外部碎片。
#### 段页式存储
1. 存储原理：将进程的地址空间按逻辑分为若干个段（代码段，数据段），每个段大小不固定，每个段划分为若干页，每页固定大小。这样既有分段的灵活，也有分页的高效。
2. 地址结构：地址地址分为段号，页号，页内偏移量
3. 地址映射原理：操作系统为每个进程维护一个段表，每个段表记录该段的起始地址和长度，以及该段的页表地址。访问时，先用段号查询段表，得到页表地址和长度，检查页号和偏移量越界，用页号查询页表，得到物理页框号。
#### 虚拟存储
1. 程序局部性原理：时间局部性（某一时间被访问的数据，短时间内会再次被访问）、空间局部性（当前访问数据的相邻数据，近期页可能被访问）利用局限性原理，只将当前需要的部分数据装入内存，提高利用率。 
2. 虚拟存储器的实现：分页、分段、段页。 
3. 页面置换算法
  - 最佳置换：选择未来最长时间不会被访问的页面换出
  - FIFO：先进先出，最早调入的页面先换出
  - LRU：最近最少使用，换出最长时间未被使用的页面
  - NRU：最近未使用，根据访问和修改情况分级换出

### 设备管理
#### I/O 软件
I/O 软件的操作过程如图 4-2 所示。
#### 相关技术
1. 通道：是一种专用的IO处理器，负责管理外部设备数据传输，可独立于cpu执行IO操作，减轻cpu负担
2. DMA：直接存储器访问，无需cpu干预，dma控制器负责数据传输，cpu只发起和结束操作
3. 缓冲
4. Spooling：假脱机，将外部设备的输入和输出先存入磁盘，按顺序存储

### 文件管理
#### 文件与文件系统
1. 文件。 
2. 文件系统。 
3. 文件类型。 
#### 文件结构和组织
1. 逻辑结构：顺序结构，索引结构，散列结构。 
2. 物理结构：连续、链接、索引、索引表。 
#### 目录
1. 文件控制块（FCB）：目录项中包含文件名，文件类型，物理地址，大小，创建时间，权限
2. 目录结构（一级、二级、多级）。 
#### 存储方法与空间
1. 空闲区表：用表格记录磁盘上所有空间的起始地址和长度，适合连续分配方式。 
2. 位示图：用一组二进制表示磁盘每个块的使用情况，1：已占用，0：空闲
3. 空闲块链：将所有空闲块通过指针链接成链表，分为单链和多链
4. 成组链接法：将若干空闲块分为一组，每组用表项记录，每组通过指针链接。
#### 共享与保护
（1）文件共享：硬链接（多个目录指向同一个物理文件，删除链接不影响文件，都删除才释放文件）、符号链接（软链接，目录项存储目录文件的路径名）。 
（2）文件保护：存取控制矩阵、存取控制表、用户权限表、密码。 
#### 安全与可靠性
（1）系统安全：系统级、用户级、目录级、文件级。 
（2）文件系统的可靠性：转储和恢复、日志文件、一致性。

### 作业管理
#### 作业与作业控制
1. 作业控制。 
2. 作业状态及转换：提交、后备、执行、完成。 
3. JCB 和作业后备队列。 
#### 作业调度
1. 先来先服务：按作业到达顺序调度
2. 短作业优先：优先调度短作业
3. 响应比高优先：根据响应比选择作业
4. 优先级调度算法：根据作业优先级调度
5. 均衡调度算法：综合考虑系统负载和资源利用率，动态调整调度策略